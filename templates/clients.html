<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clients</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <a id="BTN" href="{{ url_for('dashboard') }}" class="btn btn-primary"
      >Back to Home</a
    >

    <h1>Clients</h1>
    <table class="table">
      <thead>
        <tr>
          <th><strong>Name</strong></th>
          <th><strong>Phone Number</strong></th>
          <th><strong>Address</strong></th>
          <th><strong>Balance</strong></th>
          <th><strong>Actions</strong></th>
        </tr>
      </thead>
      <tbody>
        {% for client in clients %}
        <tr>
          <td id="tdEven"><strong>{{ client[1] }}</strong></td>
          <td id="tdOdd"><strong>{{ client[2] }}</strong></td>
          <td id="tdEven"><strong>{{ client[3] }}</strong></td>
          <td id="tdOdd"><strong>{{ client[4] }}</strong></td>
          <td id="tdEven">
            <button
              class="btn btn-success"
              onclick='makePayment("{{ client[0] }}")'
            >
              Payment
            </button>
            <a
              href="{{ url_for('delete_client', client_id=client[0]) }}"
              class="btn btn-danger"
              onclick="return confirm('Are you sure you want to delete this client?')"
              ><strong>Delete</strong></a
            >
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <script>
      function makePayment(clientId) {
        var paymentAmount = prompt("Enter the payment amount:");
        if (paymentAmount !== null) {
          paymentAmount = parseFloat(paymentAmount);
          if (!isNaN(paymentAmount) && paymentAmount > 0) {
            // Send an AJAX request to update the client's balance
            var xhr = new XMLHttpRequest();
            xhr.open(
              "POST",
              "/make_payment/" + clientId + "/" + paymentAmount,
              true
            );
            xhr.setRequestHeader(
              "Content-Type",
              "application/x-www-form-urlencoded"
            );
            xhr.onreadystatechange = function () {
              if (xhr.readyState === XMLHttpRequest.DONE) {
                if (xhr.status === 200) {
                  alert("Payment successful!");
                  location.reload(); // Reload the page to reflect the updated balance
                } else {
                  alert("An error occurred while processing the payment.");
                }
              }
            };
            xhr.send();
          } else {
            alert("Invalid amount. Please enter a positive number.");
          }
        }
      }
    </script>

    <a id="addClientBTN" href="{{ url_for('add_client') }}" class="btn btn-success">Add Client</a>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
